<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Features — Camila Tiburcio Rubio</title>

  <!-- Fonts + Tailwind -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Source+Serif+4:opsz,wght@8..60,400..800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter','system-ui','sans-serif'],
            serif: ['Source Serif 4','Georgia','serif']
          },
          colors: {
            ink: { 900:'#0E0E0E',700:'#1F1F1F',500:'#3A3A3A',300:'#9CA3AF' },
            cream: '#FAF7F2',
            accent: { DEFAULT:'#C53D2F', dark:'#9E2F24', light:'#E95A49' }
          },
          boxShadow: { soft:'0 10px 30px rgba(0,0,0,0.06)' }
        }
      }
    }
  </script>

  <style>
    .u-underline { position: relative; }
    .u-underline::after {
      content: ''; position: absolute; left: 0; bottom: -2px; height: 2px; width: 100%;
      background: currentColor; transform: scaleX(0); transform-origin: left; transition: transform .25s ease;
    }
    .u-underline:hover::after { transform: scaleX(1); }

    .card { background:#fff; border-radius:1rem; box-shadow:0 10px 30px rgba(0,0,0,.06); overflow:hidden; }

    .chip { border:1px solid rgba(0,0,0,.10); border-radius:9999px; padding:.45rem .8rem; font-weight:600; font-size:.85rem; }
    .chip[data-active="true"] { background:rgba(197,61,47,.10); color:#C53D2F; border-color:rgba(197,61,47,.35); }

    ::selection { background: rgba(197,61,47,0.15); }
  </style>

  <!-- Canonical / Social (update domain when live) -->
  <link rel="canonical" href="https://example.com/features" />
  <meta property="og:type" content="website">
  <meta property="og:title" content="Features — Camila Tiburcio Rubio">
  <meta property="og:description" content="Featured essays, interviews, reviews, and visual stories.">
  <meta property="og:url" content="https://example.com/features">
  <meta property="og:image" content="https://picsum.photos/1200/630?features">
  <meta name="twitter:card" content="summary_large_image">
</head>

<body class="bg-cream text-ink-900 antialiased">
  <!-- Top strip -->
  <div class="bg-ink-900 text-white text-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2 flex items-center justify-between">
      <p>New: Fall features now live — interviews, essays & visual art</p>
      <a href="Home.html#newsletter" class="u-underline">Subscribe</a>
    </div>
  </div>

  <!-- Header -->
  <header class="sticky top-0 z-50 backdrop-blur supports-[backdrop-filter]:bg-cream/80 bg-cream/95 border-b border-black/5">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-20">
        <!-- Brand -->
        <a href="Home.html" class="flex items-center gap-2" aria-label="Home">
          <img src="assets/logo.png" alt="Camila Tiburcio Rubio logo" class="h-10 w-10 object-contain" />
          <span class="font-serif text-2xl tracking-tight">Camila Tiburcio Rubio</span>
        </a>

        <!-- Desktop nav -->
        <nav class="hidden md:flex items-center gap-8" aria-label="Primary">
          <a class="u-underline font-semibold text-accent" href="features.html" aria-current="page">Features</a>
          <a class="u-underline" href="Home.html#latest">Latest</a>
          <a class="u-underline" href="Home.html#sections">Sections</a>
          <a class="u-underline" href="about2.html">About</a>
        </nav>

        <!-- Search (desktop) -->
        <div class="hidden md:flex items-center gap-4">
          <label class="relative" aria-label="Search features">
            <input id="q" type="search" placeholder="Search features…" class="pl-10 pr-3 py-2 rounded-full border border-black/10 bg-white/70 focus:bg-white outline-none focus:ring-2 focus:ring-accent/40" />
            <svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-ink-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><circle cx="11" cy="11" r="7" stroke-width="2"/><path stroke-width="2" d="M21 21l-3.5-3.5"/></svg>
          </label>
        </div>

        <!-- Mobile hamburger -->
        <div class="md:hidden">
          <button id="menuToggle" class="p-2 rounded-md border border-black/10 focus:outline-none" aria-expanded="false" aria-controls="mobileMenu" aria-label="Open menu">
            <svg id="menuIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile dropdown menu -->
    <div id="mobileMenu" class="hidden md:hidden bg-cream border-t border-black/10">
      <nav class="px-4 py-4 space-y-3" aria-label="Mobile">
        <a class="block u-underline font-semibold text-accent" href="features.html">Features</a>
        <a class="block u-underline" href="Home.html#latest">Latest</a>
        <a class="block u-underline" href="Home.html#sections">Sections</a>
        <a class="block u-underline" href="about2.html">About</a>
        <label class="relative block mt-3" aria-label="Search features">
          <input id="q-mobile" type="search" placeholder="Search features…" class="w-full pl-10 pr-3 py-2 rounded-full border border-black/10 bg-white/70 focus:bg-white outline-none focus:ring-2 focus:ring-accent/40" />
          <svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-ink-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><circle cx="11" cy="11" r="7" stroke-width="2"/><path stroke-width="2" d="M21 21l-3.5-3.5"/></svg>
        </label>
      </nav>
    </div>
  </header>

  <!-- Page header -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
    <div class="flex items-end justify-between">
      <div>
        <div class="text-[10px] sm:text-xs tracking-[0.14em] font-semibold text-accent uppercase">Browse</div>
        <h1 class="font-serif text-4xl sm:text-5xl leading-tight mt-1">Features</h1>
        <p class="text-ink-500 mt-2">Handpicked essays, interviews, reviews, and visual stories.</p>
      </div>
      <div class="hidden sm:flex items-center gap-2">
        <label class="text-sm text-ink-500" for="sort">Sort by</label>
        <select id="sort" class="px-3 py-2 rounded-xl border border-black/10 bg-white">
          <option value="new">Newest</option>
          <option value="old">Oldest</option>
          <option value="title">Title (A–Z)</option>
        </select>
      </div>
    </div>
  </section>

  <!-- Hero featured story -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
    <article class="grid lg:grid-cols-3 gap-8 items-stretch card">
      <div class="lg:col-span-2">
        <img id="heroImg" class="w-full h-full object-cover aspect-[16/9]" src="https://picsum.photos/1200/675?hero" alt="Feature hero image">
      </div>
      <div class="p-6 sm:p-8 flex flex-col">
        <div class="flex items-center gap-3 text-xs uppercase tracking-wide text-accent">
          <span class="bg-accent/10 text-accent px-2.5 py-1 rounded-full">Feature</span>
          <time id="heroDate" class="text-ink-300" datetime="">—</time>
        </div>
        <h2 id="heroTitle" class="font-serif text-3xl mt-3 leading-tight">
          The Archive Sings: Sound, Memory, and Diaspora
        </h2>
        <p id="heroExcerpt" class="text-ink-500 mt-3">A longform essay weaving field recordings, neighborhood histories, and oral tradition into a listening guide for place.</p>
        <div class="mt-auto pt-5 flex items-center gap-4">
          <img id="heroAvatar" class="h-10 w-10 rounded-full object-cover" src="https://i.pravatar.cc/100?img=15" alt="Author avatar"/>
          <div>
            <p class="text-sm font-medium">By <a class="u-underline" href="about2.html">Camila Tiburcio Rubio</a></p>
            <p id="heroRead" class="text-xs text-ink-300">—</p>
          </div>
        </div>
        <a id="heroLink" href="#" class="mt-4 inline-block u-underline">Read the feature →</a>
      </div>
    </article>
  </section>

  <!-- Filters -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-10">
    <div class="flex flex-col lg:flex-row lg:items-center gap-3 justify-between">
      <div class="flex flex-wrap gap-2">
        <button class="chip" data-filter="all" data-active="true" aria-pressed="true">All</button>
        <button class="chip" data-filter="Essay">Essay</button>
        <button class="chip" data-filter="Interview">Interview</button>
        <button class="chip" data-filter="Review">Review</button>
        <button class="chip" data-filter="Visual">Visual</button>
        <button class="chip" data-filter="Community">Community</button>
        <button class="chip" data-filter="Memoirs">Memoirs</button>
      </div>
      <div class="flex items-center gap-2">
        <label class="text-sm text-ink-500 hidden sm:inline" for="q-inline">Search</label>
        <input id="q-inline" type="search" placeholder="Keywords…" class="px-3 py-2 rounded-xl border border-black/10 bg-white w-64 max-w-full" />
      </div>
    </div>
  </section>

  <!-- Grid -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
    <div id="grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>

    <!-- Card template (keeps your exact card structure) -->
    <template id="cardTemplate">
      <article class="card flex flex-col">
        <img class="aspect-[16/10] object-cover" src="" alt="" />
        <div class="p-6 flex-1 flex flex-col">
          <div class="text-xs uppercase tracking-wide text-accent sectionLabel"></div>
          <h3 class="font-serif text-xl mt-2 leading-snug">
            <a class="u-underline link" href="#"></a>
          </h3>
          <p class="text-ink-500 mt-2 desc"></p>
          <div class="mt-auto pt-4 text-sm text-ink-300 meta"></div>
        </div>
      </article>
    </template>

  <!-- Footer -->
  <footer class="mt-16 bg-white border-t border-black/10 text-sm text-ink-500">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 grid sm:grid-cols-2 md:grid-cols-4 gap-10">
      <!-- Brand -->
      <div>
        <div class="-ml-1.5">
          <div class="flex items-center gap-1">
            <img src="assets/logo.png" alt="Camila Tiburcio Rubio logo" class="h-8 w-8 object-contain" />
            <span class="font-semibold text-ink-900">Camila Tiburcio Rubio</span>
          </div>
        </div>
        <p class="mt-2 text-ink-400 text-sm max-w-xs">
          Essays, interviews, and conversations from the life and mind of Camila Tiburcio Rubio.
        </p>
      </div>

      <!-- Explore -->
      <div>
        <h3 class="font-semibold text-ink-900 mb-3">Explore</h3>
        <ul class="space-y-2">
          <li><a href="features.html" class="u-underline">Features</a></li>
          <li><a href="Home.html#latest" class="u-underline">Latest</a></li>
          <li><a href="sections.html" class="u-underline">Sections</a></li>
        </ul>
      </div>

      <!-- About -->
      <div>
        <h3 class="font-semibold text-ink-900 mb-3">About</h3>
        <ul class="space-y-2">
          <li><a href="about2.html" class="u-underline">About</a></li>
          <li><a href="contact.html" class="u-underline">Contact</a></li>
        </ul>
      </div>

      <!-- Follow -->
      <div>
        <h3 class="font-semibold text-ink-900 mb-3">Follow</h3>
        <ul class="space-y-2">
          <li><a href="https://instagram.com" class="u-underline" target="_blank" rel="me noopener">Instagram</a></li>
          <li><a href="https://twitter.com" class="u-underline" target="_blank" rel="me noopener">X / Twitter</a></li>
          <li><a href="https://youtube.com" class="u-underline" target="_blank" rel="me noopener">YouTube</a></li>
        </ul>
      </div>
    </div>

    <div class="text-center text-xs text-ink-300 border-t border-black/10 py-6">
      © <span id="year"></span> Camila Tiburcio Rubio. All rights reserved.
    </div>
  </footer>

    <script>
    // ---------------------------
    // Utilities
    // ---------------------------
    const $ = (s,r=document)=>r.querySelector(s);
    const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
    function fmtDate(iso){ try { return new Date(iso).toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'}) } catch { return '' } }
    const byNewest=(a,b)=>new Date(b.date)-new Date(a.date);
    const byOldest=(a,b)=>new Date(a.date)-new Date(b.date);

    // ---------------------------
    // Data sources (posts.json -> local cache -> demo)
    // Expected shape:
    // { slug, title, section, tags, author, excerpt, date, readMinutes, featured, cover, url }
    // ---------------------------
    async function fetchPostsJson(){
      try{
        const res = await fetch('posts.json', { cache: 'no-store' });
        if(!res.ok) throw new Error('fetch failed');
        const data = await res.json();
        return Array.isArray(data) ? data : null;
      }catch{ return null; }
    }

    function loadPublishedLocal(){
      const out=[];
      for(let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if(k && k.startsWith('ctr:admin:published:')){
          try{ const obj = JSON.parse(localStorage.getItem(k)); if(obj && obj.title) out.push(obj);}catch{}
        }
      }
      return out;
    }

    const DEMO = [
      { title:'Street Art as Unofficial Syllabus', url:'article/street-art-syllabus.html', date:'2025-10-01', section:'Essay', excerpt:'What murals teach us about place, politics, and public imagination.', readMinutes:7, cover:'https://picsum.photos/600/375?4', featured:true },
      { title:'Life as an Archivist', url:'article/life-as-an-archivist.html', date:'2025-09-28', section:'Interview', excerpt:'On preserving local histories beyond institutions.', readMinutes:12, cover:'https://picsum.photos/600/375?5', featured:false },
      { title:'Films that Map the Diaspora', url:'article/films-that-map-the-diaspora.html', date:'2025-09-22', section:'Review', excerpt:'Must-see films regarding the diaspora far and wide.', readMinutes:9, cover:'https://picsum.photos/600/375?6', featured:true }
    ];

    function normalize(p){
      const href = (p.url && p.url.trim()) ? p.url.trim() : (p.slug ? `${p.slug}.html` : '#');
      return {
        title: p.title || '',
        href,
        section: p.section || '',
        excerpt: p.excerpt || p.description || '',
        date: p.date || p.publishedAt || '',
        read: p.readMinutes || '',
        tags: Array.isArray(p.tags)? p.tags.join(', ') : (p.tags || ''),
        featured: !!p.featured, // <-- critical
        cover: p.cover || 'https://picsum.photos/600/375?random',
        author: p.author || 'Camila Tiburcio Rubio'
      };
    }

    let POSTS = [];      // all posts (raw normalized)
    let CURRENT = [];    // the list currently rendered (only featured here)

    // ---------------------------
    // Render: Hero + Grid
    // ---------------------------
    function pickHero(items){
      const featured = items.filter(p => p.featured).sort(byNewest);
      return (featured[0] || null);
    }

    function fillHero(post){
      if(!post) return; // leaves your default hero copy as-is if no featured posts exist
      const heroImg = $('#heroImg');
      heroImg.src = post.cover || heroImg.src;
      heroImg.alt = post.title || 'Feature hero image';
      const t = $('#heroTitle'); t.textContent = post.title || t.textContent;
      const d = $('#heroDate'); d.textContent = fmtDate(post.date); d.dateTime = post.date || '';
      const ex = $('#heroExcerpt'); ex.textContent = post.excerpt || ex.textContent;
      const rd = $('#heroRead'); rd.textContent = (post.read ? `${post.read} min read` : '');
      const link = $('#heroLink'); link.href = post.href || '#';
    }

    function buildCard(post){
      const tpl = $('#cardTemplate').content.cloneNode(true);
      const img = tpl.querySelector('img');
      img.src = post.cover;
      img.alt = `${post.title} cover`;

      tpl.querySelector('.sectionLabel').textContent = post.section || 'Feature';
      const a = tpl.querySelector('.link');
      a.href = post.href || '#';
      a.textContent = post.title || '';
      tpl.querySelector('.desc').textContent = post.excerpt || '';
      const meta = [];
      if (post.date) meta.push(fmtDate(post.date));
      if (post.read) meta.push(`${post.read} min`);
      tpl.querySelector('.meta').textContent = meta.join(' • ');

      // For filtering/searching:
      const article = tpl.querySelector('article.card');
      article.dataset.section = post.section || '';
      article.dataset.title = post.title || '';
      article.dataset.tags = post.tags || '';
      article.dataset.date = post.date || '';

      return tpl;
    }

    function renderGrid(items){
      CURRENT = items.slice(); // keep what we're showing
      const grid = $('#grid');
      grid.innerHTML = '';
      items.forEach(p => grid.appendChild(buildCard(p)));
      wireFilters(); // after DOM exists
    }

    // ---------------------------
    // Filters / Search / Sort (visual only)
    // ---------------------------
    function wireFilters(){
      const chips = $$('.chip');
      const qMain = $('#q');
      const qInline = $('#q-inline');
      const qMobile = $('#q-mobile');
      const sortSel = $('#sort');

      function norm(s){ return (s||'').toLowerCase(); }
      function apply(){
        const cards = $$('#grid article.card');
        const active = chips.find(c => c.dataset.active === 'true')?.dataset.filter || 'all';
        const term = norm(qMain?.value || qInline?.value || qMobile?.value);

        cards.forEach(card => {
          const section = card.dataset.section;
          const title = norm(card.dataset.title);
          const tags = norm(card.dataset.tags);
          const matchesSection = (active === 'all') || (section === active);
          const matchesQuery = term ? (title.includes(term) || tags.includes(term)) : true;
          card.style.display = (matchesSection && matchesQuery) ? '' : 'none';
        });
      }

      chips.forEach(chip => {
        chip.addEventListener('click', () => {
          chips.forEach(c => c.dataset.active = 'false');
          chip.dataset.active = 'true';
          chip.setAttribute('aria-pressed', 'true');
          apply();
        });
      });

      [qMain, qInline, qMobile].forEach(el => el?.addEventListener('input', apply));

      sortSel?.addEventListener('change', () => {
        const grid = $('#grid');
        const items = Array.from(grid.children).filter(el => el.matches('article.card'));
        const mode = sortSel.value;

        if (mode === 'title') {
          items.sort((a,b)=> (a.dataset.title||'').localeCompare(b.dataset.title||''));
        } else if (mode === 'old') {
          items.sort((a,b)=> new Date(a.dataset.date||0) - new Date(b.dataset.date||0));
        } else {
          items.sort((a,b)=> new Date(b.dataset.date||0) - new Date(a.dataset.date||0));
        }

        items.forEach(it => grid.appendChild(it));
      });

      apply();
    }

    // ---------------------------
    // Boot
    // ---------------------------
    document.getElementById('year').textContent = new Date().getFullYear();

    // Mobile menu toggle
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    menuToggle?.addEventListener('click', () => {
      const isHidden = mobileMenu.classList.toggle('hidden');
      menuToggle.setAttribute('aria-expanded', String(!isHidden));
    });

    (async function init(){
      // 1) Try posts.json
      const j = await fetchPostsJson();
      if (j && j.length) {
        POSTS = j.map(normalize).sort(byNewest);
      } else {
        // 2) Fallback to locally published (from admin)
        const local = loadPublishedLocal();
        if (local.length) {
          POSTS = local.map(normalize).sort(byNewest);
        } else {
          // 3) Demo
          POSTS = DEMO.map(normalize).sort(byNewest);
        }
      }

      // ***** ONLY SHOW FEATURED *****
      const FEATURED = POSTS.filter(p => p.featured);
      // Hero shows most recent featured (if any). If none, default hero stays.
      const hero = FEATURED.length ? FEATURED.slice().sort(byNewest)[0] : null;
      if (hero) fillHero(hero);

      // Grid: ONLY featured posts
      renderGrid(FEATURED);
    })();
  </script>
</body>
</html>
