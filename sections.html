<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sections — Camila Tiburcio Rubio</title>

  <!-- Fonts + Tailwind -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Source+Serif+4:opsz,wght@8..60,400..800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter','system-ui','sans-serif'],
            serif: ['Source Serif 4','Georgia','serif']
          },
          colors: {
            ink: { 900:'#0E0E0E',700:'#1F1F1F',500:'#3A3A3A',300:'#9CA3AF' },
            cream: '#FAF7F2',
            accent: { DEFAULT:'#C53D2F', dark:'#9E2F24', light:'#E95A49' }
          },
          boxShadow: { soft:'0 10px 30px rgba(0,0,0,0.06)' }
        }
      }
    }
  </script>

  <style>
    .u-underline { position: relative; }
    .u-underline::after {
      content:''; position:absolute; left:0; bottom:-2px; height:2px; width:100%;
      background:currentColor; transform:scaleX(0); transform-origin:left; transition:transform .25s ease;
    }
    .u-underline:hover::after { transform:scaleX(1); }
    ::selection { background: rgba(197,61,47,0.15); }

    /* Icon toggle: shows + when collapsed and − when expanded */
    .icon-toggle {
      width: 36px; height: 36px;
      display: inline-flex; align-items: center; justify-content: center;
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 9999px;
      background: #fff;
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .icon-toggle:hover { box-shadow: 0 8px 20px rgba(0,0,0,.06); border-color: rgba(0,0,0,.2); }
    .icon-toggle:active { transform: scale(0.97); }
    .icon-toggle::before {
      content: "+";
      font-size: 18px; line-height: 1; color: #C53D2F; /* accent */
      transform: translateY(-1px);
    }
    .icon-toggle[aria-expanded="true"]::before {
      content: "−";
    }
    .icon-toggle .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }


    .card { background:#fff; border-radius:1rem; box-shadow:0 10px 30px rgba(0,0,0,.06); }
    .tab { padding:.55rem .9rem; border-radius:9999px; border:1px solid rgba(0,0,0,.1); font-weight:600; }
    .feat-img { aspect-ratio:16/9; width:100%; object-fit:cover; }
    .thumb { width:100%; aspect-ratio:16/10; object-fit:cover; border-radius:.75rem; }
    .kicker { text-transform:uppercase; letter-spacing:.14em; font-weight:700; font-size:.65rem; color:#C53D2F; }
    mark.hl { background: rgba(197,61,47,.22); color: inherit; padding: 0 .15em; border-radius: .25em; }

    /* Section tiles */
    .tile { transition: transform .2s ease, box-shadow .2s ease; }
    .tile:hover { transform: translateY(-2px); box-shadow: 0 12px 38px rgba(0,0,0,.08); }

    /* Hide native clear buttons on search inputs */
    input[type="search"]::-webkit-search-cancel-button,
    input[type="search"]::-webkit-search-decoration,
    input[type="search"]::-webkit-search-results-button,
    input[type="search"]::-webkit-search-results-decoration {
      -webkit-appearance: none;
      appearance: none;
      display: none;
    }
    input[type="search"]::-ms-clear { display: none; }
  </style>

  <!-- Canonical / Social (update domain when live) -->
  <link rel="canonical" href="https://example.com/sections" />
  <meta property="og:type" content="website">
  <meta property="og:title" content="Sections — Camila Tiburcio Rubio">
  <meta property="og:description" content="Browse essays, interviews, reviews, visuals, community posts, and memoirs.">
  <meta property="og:url" content="https://example.com/sections">
  <meta property="og:image" content="https://picsum.photos/1200/630?sections">
  <meta name="twitter:card" content="summary_large_image">
</head>

<body class="bg-cream text-ink-900 antialiased">

  <!-- Top strip -->
  <div class="bg-ink-900 text-white text-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2 flex items-center justify-between">
      <p>New: Fall features now live — interviews, essays & visual art</p>
      <a href="Home.html#newsletter" class="u-underline">Subscribe</a>
    </div>
  </div>

  <!-- Header -->
  <header class="sticky top-0 z-50 backdrop-blur supports-[backdrop-filter]:bg-cream/80 bg-cream/95 border-b border-black/5">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-20">
        <!-- Brand -->
        <a href="index.html" class="flex items-center gap-2" aria-label="Home">
          <img src="assets/logo.png" alt="Camila Tiburcio Rubio logo" class="h-10 w-10 object-contain" />
          <span class="font-serif text-2xl tracking-tight">Camila Tiburcio Rubio</span>
        </a>

        <!-- Desktop nav -->
        <nav class="hidden md:flex items-center gap-8" aria-label="Primary">
          <a class="u-underline" href="features.html">Features</a>
          <a class="u-underline" href="latest.html">Latest</a>
          <a class="u-underline font-semibold text-accent" href="sections.html" aria-current="page">Sections</a>
          <a class="u-underline" href="about2.html">About</a>
        </nav>

        <!-- Desktop search (routes to search page) -->
        <div class="hidden md:flex items-center gap-4">
          <label class="relative" aria-label="Search site">
            <input id="q-desktop" type="search" placeholder="Search…" class="pl-10 pr-9 py-2 rounded-full border border-black/10 bg-white/70 focus:bg-white outline-none focus:ring-2 focus:ring-accent/40" />
            <svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-ink-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><circle cx="11" cy="11" r="7" stroke-width="2"/><path stroke-width="2" d="M21 21l-3.5-3.5"/></svg>
            <button id="qHeaderBtn" class="absolute right-2 top-1/2 -translate-y-1/2 text-ink-300 hover:text-ink-500" aria-label="Go to search">↵</button>
          </label>
        </div>

        <!-- Mobile hamburger -->
        <div class="md:hidden">
          <button id="menuToggle" class="p-2 rounded-md border border-black/10 focus:outline-none" aria-expanded="false" aria-controls="mobileMenu" aria-label="Open menu">
            <svg id="menuIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile dropdown -->
    <div id="mobileMenu" class="hidden md:hidden bg-cream border-t border-black/10">
      <nav class="px-4 py-4 space-y-3" aria-label="Mobile">
        <a class="block u-underline" href="features.html">Features</a>
        <a class="block u-underline" href="latest.html">Latest</a>
        <a class="block u-underline font-semibold text-accent" href="sections.html" aria-current="page">Sections</a>
        <a class="block u-underline" href="about2.html">About</a>
        <label class="relative block mt-3" aria-label="Search titles in section">
          <input id="q-mobile" type="search" placeholder="Search..." class="w-full pl-10 pr-3 py-2 rounded-full border border-black/10 bg-white/70 focus:bg-white outline-none focus:ring-2 focus:ring-accent/40" />
          <svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-ink-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><circle cx="11" cy="11" r="7" stroke-width="2"/><path stroke-width="2" d="M21 21l-3.5-3.5"/></svg>
        </label>
      </nav>
    </div>
  </header>

  <!-- Page header -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
    <div class="flex items-end justify-between">
      <div>
        <div class="text-[10px] sm:text-xs tracking-[0.14em] font-semibold text-accent uppercase">Browse</div>
        <h1 class="font-serif text-4xl sm:text-5xl leading-tight mt-1">Sections</h1>
        <p class="text-ink-500 mt-2">Quickly jump into a section, or expand a category below to see its latest.</p>
      </div>
      <div class="hidden sm:flex items-center gap-2">
        <label class="text-sm text-ink-500" for="sort">Sort within groups</label>
        <select id="sort" class="px-3 py-2 rounded-xl border border-black/10 bg-white">
          <option value="new" selected>Newest</option>
          <option value="old">Oldest</option>
          <option value="title">Title (A–Z)</option>
          <option value="read">Read time</option>
        </select>
      </div>
    </div>
  </section>

  <!-- Quick filter + tiles -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6">
    <div class="flex flex-col lg:flex-row lg:items-center gap-3 justify-between">
      <div class="flex items-center gap-3">
        <label class="sr-only" for="q-inline">Filter titles</label>
        <input id="q-inline" type="search" placeholder="Filter titles, descriptions…" class="px-3 py-2 rounded-xl border border-black/10 bg-white w-72 max-w-full focus:bg-white outline-none focus:ring-2 focus:ring-accent/40" />
      </div>
      <p class="text-xs text-ink-300">Tip: Click a tile to jump to its section.</p>
    </div>

    <!-- Section tiles (counts update with filter) -->
    <div id="tiles" class="mt-5 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3"></div>
  </section>

  <!-- Accordion groups -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8 space-y-6" id="groups">
    <!-- JS injects groups -->
  </section>

  <!-- Back to top -->
  <button id="backTop"
          class="fixed right-4 bottom-4 hidden px-3 py-2 rounded-full border border-black/10 bg-white shadow-soft text-sm"
          aria-label="Back to top">↑ Top</button>

  <!-- Footer -->
  <footer class="mt-16 bg-white border-t border-black/10 text-sm text-ink-500">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 grid sm:grid-cols-2 md:grid-cols-4 gap-10">
      <!-- Brand -->
      <div>
        <div class="-ml-1.5">
          <div class="flex items-center gap-1">
            <img src="assets/logo.png" alt="Camila Tiburcio Rubio Logo" class="h-8 w-8 object-contain" />
            <span class="font-semibold text-ink-900">Camila Tiburcio Rubio</span>
          </div>
        </div>
        <p class="mt-2 text-ink-400 text-sm max-w-xs">
          Essays, interviews, and conversations from the life and mind of Camila Tiburcio Rubio.
        </p>
      </div>
      <!-- Explore -->
      <div>
        <h3 class="font-semibold text-ink-900 mb-3">Explore</h3>
        <ul class="space-y-2">
          <li><a href="features.html" class="u-underline">Features</a></li>
          <li><a href="latest.html" class="u-underline">Latest</a></li>
          <li><a href="sections.html" class="u-underline font-semibold text-accent">Sections</a></li>
          <li><a href="archive.html" class="u-underline">Archive</a></li>
          <li><a href="search.html" class="u-underline">Search</a></li>
        </ul>
      </div>
      <!-- About -->
      <div>
        <h3 class="font-semibold text-ink-900 mb-3">About</h3>
        <ul class="space-y-2">
          <li><a href="about2.html" class="u-underline">About</a></li>
          <li><a href="contact.html" class="u-underline">Contact</a></li>
          <li><a href="mission.html" class="u-underline">Mission</a></li>
          <li><a href="resume.html" class="u-underline">Résumé</a></li>
          <li><a href="newsletter.html" class="u-underline">Newsletter</a></li>
        </ul>
      </div>
      <!-- Follow -->
      <div>
        <h3 class="font-semibold text-ink-900 mb-3">Follow</h3>
        <ul class="space-y-2">
          <li><a href="https://instagram.com" class="u-underline">Instagram</a></li>
          <li><a href="https://twitter.com" class="u-underline">X / Twitter</a></li>
          <li><a href="https://facebook.com" class="u-underline">Facebook</a></li>
          <li><a href="https://linkedin.com" class="u-underline">Linkedin</a></li>
          <li><a href="https://youtube.com" class="u-underline">YouTube</a></li>
        </ul>
      </div>
    </div>
    <div class="text-center text-xs text-ink-300 border-t border-black/10 py-6">
      © <span id="year"></span> Camila Tiburcio Rubio. All rights reserved.
    </div>
  </footer>

  <script>
    // Year + mobile menu
    document.getElementById('year').textContent = new Date().getFullYear();
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    menuToggle?.addEventListener('click', () => {
      const isHidden = mobileMenu.classList.toggle('hidden');
      menuToggle.setAttribute('aria-expanded', String(!isHidden));
    });

    // Back to top visibility + behavior
    const backTop = document.getElementById('backTop');
    const toggleTop = () => {
      if (window.scrollY > 600) backTop.classList.remove('hidden');
      else backTop.classList.add('hidden');
    };
    window.addEventListener('scroll', toggleTop, { passive:true });
    backTop.addEventListener('click', () => window.scrollTo({ top:0, behavior:'smooth' }));

    // -------------------------------------
    // Load posts (real posts or local cache)
    // -------------------------------------
    const POSTS_JSON_URL = '/posts.json';
    const FALLBACK_IMG = 'data:image/gif;base64,R0lGODlhAQABAAAAACw=';

    // Elements
    const sortSel   = document.getElementById('sort');
    const qDesktop  = document.getElementById('q-desktop');
    const qHeaderBtn= document.getElementById('qHeaderBtn');
    const qInline   = document.getElementById('q-inline');
    const qMobile   = document.getElementById('q-mobile');
    const tilesEl   = document.getElementById('tiles');
    const groupsEl  = document.getElementById('groups');

    // ---------- Utilities ----------
    function fmtDate(iso){
      try { return new Date(iso).toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'}); }
      catch { return iso; }
    }

    function canonSection(s=''){
      const x = String(s).trim().toLowerCase();
      if (x === 'essays') return 'Essay';
      if (x === 'interviews') return 'Interview';
      if (x === 'reviews') return 'Review';
      if (x === 'visuals') return 'Visual';
      if (x === 'communities') return 'Community';
      if (x === 'memoir' || x === 'memoirs') return 'Memoirs';
      return x ? x.charAt(0).toUpperCase() + x.slice(1) : 'Essay';
    }

    function highlight(text, termsOrString){
      const raw = Array.isArray(termsOrString) ? termsOrString.join(' ') : (termsOrString || '');
      const terms = raw.split(/\s+/).map(s => s.trim()).filter(s => s.length >= 2);
      if (!text || terms.length === 0) return String(text || '');
      const esc = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      const pat = new RegExp('(' + terms.map(esc).join('|') + ')', 'ig');
      return String(text).replace(pat, '<mark class="hl">$1</mark>');
    }

    const escapeHtml = s => (s||'').replace(/[&<>\"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));

    function normalizeFromJson(p = {}){
      const slug = (p.slug || '').replace(/^\/+/,'').replace(/\.html$/,'');
      const href = p.url || (slug ? `${slug}.html` : '#');
      const coverStr = typeof p.cover === 'string' ? p.cover : (p.cover && p.cover.src);
      return {
        title:   p.title || '',
        section: canonSection(p.section || 'Essay'),
        href,
        excerpt: p.excerpt || p.description || '',
        date:    p.date || new Date().toISOString(),
        read:    p.readMinutes || p.read || 0,
        img:     coverStr || FALLBACK_IMG
      };
    }

    function normalizeFromAdmin(d = {}){
      const slug = (d.slug || '').replace(/^\/+/,'').replace(/\.html$/,'');
      const href = `${slug || 'index'}.html`;
      const coverStr = typeof d.cover === 'string' ? d.cover : (d.cover && d.cover.src);
      return {
        title:   d.title || '',
        section: canonSection(d.section || 'Essay'),
        href,
        excerpt: d.excerpt || '',
        date:    d.date || new Date().toISOString(),
        read:    d.readMinutes || 0,
        img:     coverStr || FALLBACK_IMG
      };
    }

    async function loadPosts(){
      try{
        const res = await fetch(POSTS_JSON_URL + '?ts=' + Date.now(), { cache: 'no-store' });
        if (res.ok) {
          const data = await res.json();
          if (Array.isArray(data) && data.length){
            return data.map(normalizeFromJson);
          }
        }
      }catch(e){}
      const keys = Object.keys(localStorage).filter(k => k.startsWith('ctr:admin:published:'));
      const items = keys.map(k => {
        try { return normalizeFromAdmin(JSON.parse(localStorage.getItem(k))); }
        catch { return null; }
      }).filter(Boolean);
      return items;
    }

    function cardHTML(p, query){
      const t = highlight(escapeHtml(p.title), query);
      const e = highlight(escapeHtml(p.excerpt || ''), query);
      return `
      <article class="card overflow-hidden flex flex-col">
        <img class="thumb" src="${p.img}" alt="${escapeHtml(p.title)}">
        <div class="p-5 flex-1 flex flex-col">
          <div class="kicker">${escapeHtml(p.section)}</div>
          <h3 class="font-serif text-xl mt-2 leading-snug">
            <a class="u-underline" href="${p.href}">${t}</a>
          </h3>
          <p class="text-ink-500 mt-2">${e}</p>
          <div class="mt-auto pt-4 text-sm text-ink-300">${fmtDate(p.date)}${p.read ? ` • ${p.read} min` : ''}</div>
        </div>
      </article>`;
    }

    // State
    let ALL_POSTS = [];
    let state = {
      q: '',
      sort: 'new'
    };

    const ORDER = ['Essay','Interview','Visual','Review','Community','Memoirs'];
    const DESCRIPTIONS = {
      'Essay': 'Longer reflections and analyses.',
      'Interview': 'Conversations and dialogues.',
      'Visual': 'Photography, illustration & design.',
      'Review': 'Criticism and recommendations.',
      'Community': 'Events, notes, and participation.',
      'Memoirs': 'Personal stories and memories.'
    };

    function sortPosts(arr){
      const s = state.sort;
      return arr.slice().sort((a,b) => {
        if (s === 'new') return new Date(b.date) - new Date(a.date);
        if (s === 'old') return new Date(a.date) - new Date(b.date);
        if (s === 'title') return (a.title||'').localeCompare(b.title||'');
        if (s === 'read') return (a.read||0) - (b.read||0);
        return 0;
      });
    }

    function filterByQuery(arr){
      if (!state.q) return arr;
      const q = state.q.toLowerCase();
      return arr.filter(p =>
        (p.title||'').toLowerCase().includes(q) ||
        (p.excerpt||'').toLowerCase().includes(q)
      );
    }

    function groupPosts(){
      const groups = {};
      ORDER.forEach(s => groups[s] = []);
      ALL_POSTS.forEach(p => {
        const s = canonSection(p.section);
        if (!groups[s]) groups[s] = [];
        groups[s].push(p);
      });
      // apply filter + sort within each group
      for (const key in groups){
        groups[key] = sortPosts(filterByQuery(groups[key]));
      }
      return groups;
    }

    function renderTiles(groups){
      tilesEl.innerHTML = ORDER.map(s => {
        const count = groups[s]?.length || 0;
        return `
          <button class="tile card p-4 text-left" data-goto="${s}" aria-label="Jump to ${s}">
            <div class="flex items-center justify-between">
              <span class="kicker">${s}</span>
              <span class="text-xs px-2 py-1 rounded-full bg-accent/10 text-accent font-semibold">${count}</span>
            </div>
            <div class="mt-2 font-serif text-lg leading-snug">${s}</div>
            <p class="text-ink-500 text-sm mt-1">${DESCRIPTIONS[s] || ''}</p>
          </button>
        `;
      }).join('');

      // click to scroll
      tilesEl.querySelectorAll('[data-goto]').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-goto');
          const el = document.getElementById('group-' + id);
          if (el) {
            el.scrollIntoView({ behavior:'smooth', block:'start' });
            // auto-open if collapsed
            const toggle = el.querySelector('[data-accordion-toggle]');
            if (toggle && toggle.getAttribute('aria-expanded') === 'false') {
              toggle.click();
            }
          }
        });
      });
    }

    function groupSectionHTML(sectionName, posts){
      const count = posts.length;
      // show up to 4 initially to keep it compact; the rest hidden until expanded
      const preview = posts.slice(0, 4);
      const rest    = posts.slice(4);

      const previewGrid = preview.length
        ? `<div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">${preview.map(p => cardHTML(p, state.q)).join('')}</div>`
        : `<p class="text-ink-300 mt-4">No posts yet.</p>`;

      const restGrid = rest.length
        ? `<div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-6 hidden" data-rest>${rest.map(p => cardHTML(p, state.q)).join('')}</div>`
        : '';

      const moreBtn = rest.length
        ? `<button class="mt-4 px-4 py-2 rounded-full border border-black/10 hover:bg-white text-sm" data-showmore>
             Show ${rest.length} more
           </button>`
        : '';

      return `
        <section id="group-${sectionName}" class="card p-5 sm:p-6" aria-labelledby="h-${sectionName}">
          <div class="flex items-start justify-between gap-4">
            <div>
              <div class="text-[10px] sm:text-xs tracking-[0.14em] font-semibold text-accent uppercase">${sectionName}</div>
              <h2 id="h-${sectionName}" class="font-serif text-2xl sm:text-3xl mt-1">${sectionName}</h2>
              <p class="text-ink-500 mt-1">${DESCRIPTIONS[sectionName] || ''}</p>
            </div>
            <div class="text-right shrink-0">
              <span class="inline-block text-xs px-2 py-1 rounded-full bg-accent/10 text-accent font-semibold">${count} item${count===1?'':'s'}</span>
              <div class="mt-2">
                <button class="icon-toggle"
                        data-accordion-toggle
                        aria-expanded="false"
                        aria-controls="body-${sectionName}">
                  <span class="sr-only">Toggle ${sectionName} section</span>
                </button>
              </div>
            </div>
          </div>

          <div id="body-${sectionName}" class="mt-2 hidden">
            ${previewGrid}
            ${restGrid}
            ${moreBtn}
            <div class="mt-6 text-sm text-ink-300">
              <a class="u-underline" href="archive.html?section=${encodeURIComponent(sectionName)}">Open full archive →</a>
            </div>
          </div>
        </section>
      `;
    }

    function renderGroups(groups){
      groupsEl.innerHTML = ORDER.map(s => groupSectionHTML(s, groups[s] || [])).join('');

      // Accordion toggles
      groupsEl.querySelectorAll('[data-accordion-toggle]').forEach(btn => {
        btn.addEventListener('click', () => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', String(!expanded));
          const body = btn.closest('section').querySelector('[id^="body-"]');
          if (body) body.classList.toggle('hidden');
        });

      // Show more buttons
      groupsEl.querySelectorAll('[data-showmore]').forEach(btn => {
        btn.addEventListener('click', () => {
          const rest = btn.closest('section').querySelector('[data-rest]');
          if (rest) {
            rest.classList.remove('hidden');
            btn.remove();
          }
        });
      });
    }

    function renderAll(){
      const groups = groupPosts();
      renderTiles(groups);
      renderGroups(groups);
    }

    // Desktop header search -> search page
    function goToSearch(){
      const q = (qDesktop?.value || '').trim();
      const url = q ? `search.html?q=${encodeURIComponent(q)}` : 'search.html';
      location.href = url;
    }
    qHeaderBtn?.addEventListener('click', (e) => { e.preventDefault(); goToSearch(); });
    qDesktop?.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') { e.preventDefault(); goToSearch(); }
    });

    // Controls
    sortSel?.addEventListener('change', () => { state.sort = sortSel.value; renderAll(); });
    [qInline, qMobile].forEach(inp => inp?.addEventListener('input', (e) => {
      state.q = (e.target.value || '').trim();
      renderAll();
    }));

    // Init
    (async function init(){
      ALL_POSTS = await loadPosts();
      // Default-open the first non-empty section for a stronger sense of importance
      renderAll();
      // Open the first with content
      for (const name of ORDER){
        const has = groupPosts()[name]?.length;
        if (has > 0) {
          const first = document.querySelector(`#group-${name} [data-accordion-toggle]`);
          if (first) first.click();
          break;
        }
      }
    })();
  </script>
</body>
</html>
